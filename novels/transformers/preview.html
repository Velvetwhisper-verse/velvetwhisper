<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <title>变形金刚乙女试读包 | VelvetWhisper</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      background: #0a0a0a;
      color: #f2c2e0;
      font-family: "Georgia", serif;
      line-height: 1.8;
      padding: 40px 24px 80px;
      max-width: 740px;
      margin: auto;
      transition: filter 0.3s ease;
    }
    h1 {
      font-size: 2em;
      text-align: center;
      font-family: 'Quicksand', sans-serif;
      margin: 60px 0 40px;
    }
    #content.blur {
      filter: blur(10px);
    }
    .watermark {
      position: fixed;
      bottom: 12px;
      right: 12px;
      font-size: 0.85em;
      color: #555;
      opacity: 0.5;
    }
    body::before {
      content: "BabyAlexis-huang13542572567@qq.com";
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      font-size: 3em;
      font-family: 'Georgia', serif;
      color: rgba(242, 194, 224, 0.08);
      z-index: 0;
      pointer-events: none;
      white-space: pre;
      background: repeating-linear-gradient(
        -45deg,
        rgba(242, 194, 224, 0.08) 0,
        rgba(242, 194, 224, 0.08) 160px,
        transparent 160px,
        transparent 320px
      );
    }
  </style>
</head>
<body oncontextmenu="return false">
  <h1>变形金刚乙女试读包</h1>

  <div id="countdown-box" style="position:fixed;top:20px;right:20px;background:#111111cc;color:#f2c2e0;padding:8px 14px;border-radius:8px;font-family:'Quicksand',sans-serif;z-index:999;font-size:0.95em;box-shadow:0 0 8px #f2c2e060;">
    ⏳ 剩余阅读时间：<span id="countdown">30:00</span>
  </div>

  <div id="content" class="blur">加载中...</div>
  <div class="watermark">VelvetWhisper Preview</div>

  <script>
    const PASSWORD = "VelvetAlexis";
    const MAX_HOURS = 72;
    const KEY = "velvetPreviewStartTime_" + PASSWORD;
    const contentURL = "novels/transformers/content.html";  // 你的正文文件路径

    const tags = "包含你是我的小夜莺，沉默的爱，高纯害机不浅";

    function isExpired(start) {
      return new Date().getTime() - start > MAX_HOURS * 60 * 60 * 1000;
    }

    let startTime = localStorage.getItem(KEY);
    if (!startTime) {
      startTime = new Date().getTime();
      localStorage.setItem(KEY, startTime);
    } else {
      startTime = parseInt(startTime);
    }

    if (isExpired(startTime)) {
      document.getElementById("content").innerHTML = 
        '<div style="color:#f88;text-align:center;margin-top:20vh;">⏰ 试读已过期，请前往正式购买页面。</div>';
    } else {
      const pw = prompt("请输入试读密码：");
      if (pw !== PASSWORD) {
        document.getElementById("content").innerHTML = 
          '<div style="color:#f88;text-align:center;margin-top:20vh;">❌ 密码错误，无法解锁。</div>';
      } else {
        fetch(contentURL)
          .then(res => res.text())
          .then(data => {
            document.getElementById("content").innerHTML = `<p><b>关键词：</b>${tags}</p><div>${data}</div>`;
            document.getElementById("content").classList.remove("blur");
          });
      }
    }

    window.addEventListener("blur", () => {
      document.getElementById("content").classList.add("blur");
    });
    window.addEventListener("focus", () => {
      document.getElementById("content").classList.remove("blur");
    });

    let duration = 30 * 60;
    const display = document.getElementById("countdown");
    const contentDiv = document.getElementById("content");

    const timer = setInterval(() => {
      const minutes = Math.floor(duration / 60);
      const seconds = duration % 60;
      display.textContent = `${String(minutes).padStart(2, "0")}:${String(seconds).padStart(2, "0")}`;
      duration--;

      if (duration < 0) {
        clearInterval(timer);
        contentDiv.innerHTML = `<div style="margin-top:20vh;color:#f88;text-align:center;">⛔ 阅读时间已结束，如需继续阅读请重新获取权限。</div>`;
      }
    }, 1000);
  </script>
</body>
</html>
